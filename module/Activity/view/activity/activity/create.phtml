<?php
$this->headTitle($this->translate('Create Activity'));
$this->headLink()
    ->prependStylesheet($this->basePath() . '/css/bootstrap-markdown.min.css')
    ->prependStylesheet($this->basePath() . '/css/jquery.datetimepicker.css');
$this->headScript()
    ->prependFile($this->basePath() . '/js/bootstrap-markdown.js')
    ->prependFile($this->basePath() . '/js/activity-create.js')
    ->prependFile($this->basePath() . '/js/jquery.datetimepicker.full.min.js');

$form->prepare();
?>
<section class="section">
    <div class="container">
        <?= $this->form()->openTag($form) ?>
        <div class="row">
            <div class="col-md-12">
                <h1><?= $this->translate('Create an activity') ?></h1>
            </div>
        </div>
        <hr>
        <div class="row">
            <div class="col-md-12">
                <h2><?= $this->translate('Organizer') ?></h2>
                <p><?= $this->translate('Select the committee or fraternity responsible for this activity.') ?></p>
            </div>
            <div class="col-md-6">
                <?php
                $organ = $form->get('organ')
                    ->setAttribute('class', 'form-control')
                    ->setAttribute('id', 'organizing-organ');
                ?>
                <div class="form-group <?= $this->bootstrapElementError($organ) ?>">
                    <label for="<?= $organ->getAttribute('id') ?>" class="control-label">
                        <?= $this->translate('Committee / fraternity') ?>
                    </label>
                    <?= $this->formSelect($organ) ?>
                    <?= $this->formElementErrors($organ) ?>
                </div>
            </div>
        </div>
        <?= $this->partial('partial/create', [ 'form' => $form ]) ?>
        <div class="row">
            <div class="col-md-12">
                <h2><?= $this->translate('Additional fields') ?></h2>
                <p><?= $this->translate('Add additional fields to collect specific information from the participants.') ?></p>
            </div>
            <div class="col-md-12">
                <div class="row" id="additionalFieldsHeader" style="display: none">
                    <div class="col-md-4 col-md-offset-4">
                        <span class="flag-icon flag-icon-nl" style="background-image: url('<?= $this->basePath() ?>/img/nl.svg');"></span>
                        <strong><?= $this->translate('Dutch') ?></strong>
                        <hr />
                    </div>
                    <div class="col-md-4">
                        <span class="flag-icon flag-icon-en" style="background-image: url('<?= $this->basePath() ?>/img/en.svg');"></span>
                        <strong><?= $this->translate('English') ?></strong>
                        <hr />
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-12">
                        <?php
                        /* render template for fields */
                        $fs = $form->get('fields')->getTemplateElement();
                        ob_start();
                        echo $this->partial('partial/field-fieldset.phtml', ['fs' => $fs, 'index' => '__index__']);
                        $tpl = trim(ob_get_clean())
                        ?>
                        <fieldset id="additionalFields">
                            <span class="template" data-template="<?= $this->escapeHtmlAttr($tpl) ?>"></span>
                            <?php
                            $index = 0;
                            foreach ($form->get('fields')->getIterator() as $fs) {
                                echo $this->partial('partial/field-fieldset.phtml', ['fs' => $fs, 'index' => $index]);
                                $index++;
                            }
                            ?>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group add-field">
                                        <button class="btn btn-danger" type="button" onclick="return Activity.removeField()">
                                            <i class="fas fa-minus"></i>
                                            <?= $this->translate('Remove the last field') ?>
                                        </button>
                                        <button class="btn btn-success" type="button" onclick="return Activity.addField()">
                                            <i class="fas fa-plus"></i>
                                            <?= $this->translate('Add a field') ?>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <?php
                $submit = $form->get('submit');
                $submit->setLabel($this->translate('Create Activity'));
                $submit->setAttribute('class', 'btn btn-primary');
                ?>
                <div class="form-group">
                    <?= $this->formButton($submit) ?>
                </div>
            </div>
            <?= $this->form()->closeTag(); ?>
        </div>
    </div>
</section>

<script>
    $('[name="beginTime"]').datetimepicker();
    $('[name="endTime"]').datetimepicker();
    $('[name="subscriptionDeadline"]').datetimepicker();
    $('.markdown-editor').each(function() {
      $(this).markdown(
        {
          resize: "both",
          iconlibrary: "fa"
        }
      );
    });
    Activity.updateForm();
    for (var i = 0; i < <?= $index ?>; i++) {
        Activity.updateFieldset(i);
    }
    $(function () {
        $('[data-toggle="tooltip"]').tooltip()
    })
</script>
