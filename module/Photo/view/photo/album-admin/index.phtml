<?php
$this->headScript()
        ->prependFile($this->basePath() . '/js/photo-admin.js')
        ->prependFile($this->basePath() . '/js/photo.js');
$this->headLink()
        ->prependStylesheet($this->basePath() . '/css/photo-admin.css')
?>
<div class="row">
    <div class="col-lg-12">
        <h1><?= $this->translate('Photo admin') ?></h1><hr>
    </div>
</div>
<div class="row">
    <div class="col-lg-3">
        <div class="panel panel-default">
            <div class="panel-body">
                <ul class="tree">
                    <?php

                    function showTree($albums)
                    {
                        ?>

                        <?php foreach ($albums as $album): ?>
                            <li><a id="<?= $album->getId() ?>" href="photo/album/<?= $album->getId() ?>"><?= $album->getName() ?></a>
                                <?php if (count($album->getChildren()) > 0): ?>
                                    <ul>
                                        <?= showTree($album->getChildren()) ?>
                                    </ul>
                                <?php endif ?>
                            </li>
                        <?php endforeach ?>

                    <?php } ?>
                    <?= showTree($albums) ?>
                </ul>
            </div>
        </div>
    </div>
    <div class="col-lg-9">

        <a id="btnCreate" class="btn btn-primary" href="photo/album/create"><span class="glyphicon glyphicon-plus"></span>&nbsp;<?= $this->translate('Create new album') ?></a>
        <hr>
        <div id="albumControls">
            <ol id="breadcrumb" class="breadcrumb"></ol>
            <a id="btnEdit" type="button" class="btn btn-primary" href=""><span class="glyphicon glyphicon-edit"></span>&nbsp;<?= $this->translate('Edit album') ?></a>
            <a id="btnAdd" class="btn btn-primary" href=""><span class="glyphicon glyphicon-upload"></span>&nbsp;<?= $this->translate('Add photos') ?></a> 
            <button type="button" class="btn btn-primary"><span class="glyphicon glyphicon-folder-open"></span>&nbsp;<?= $this->translate('Move album') ?></button>
            <button type="button" data-toggle="modal" data-target="#coverModal" class="btn btn-primary btn-regenerate"><span class="glyphicon glyphicon-picture"></span>&nbsp;<?= $this->translate('Regenerate album cover') ?></button><br><br>
            <button type="button" data-toggle="modal" data-target="#deleteModal" class="btn btn-danger"><span class="glyphicon glyphicon-trash"></span>&nbsp;<?= $this->translate('Delete album') ?></button>
            <button type="button" class="btn btn-danger btn-hidden" id="remove-multiple"><span class="glyphicon glyphicon-trash"></span>&nbsp;<?= $this->translate('Delete %i photos') ?></button>
            <button type="button" class="btn btn-success"><span class="glyphicon glyphicon-globe"></span>&nbsp;<?= $this->translate('Make album private') ?></button>

        </div>
        <hr>

        <nav><ul class="pagination" id="paging"></ul></nav>
        <div id="album"></div>
    </div>
</div>

<!-- Regenerate album cover modal -->
<div class="modal fade" id="coverModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title"><?= $this->translate('Generate a new cover photo') ?></h4>
            </div>
            <div  class="modal-body">
                <center><div id="coverSpinner" class="spinner"></div>
                <img id="coverPreview" class="cover-preview" src="">
                </center>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary btn-regenerate"><?= $this->translate('Regenerate') ?></button>
                <button type="button" class="btn btn-primary" data-dismiss="modal"><?= $this->translate('Save') ?></button>
            </div>
        </div>
    </div>
</div>

<!-- Delete album modal -->
<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title"><?= $this->translate('Delete confirmation') ?></h4>
            </div>
            <div  class="modal-body">
                <div id="deleteConfirm">
                <p><?= $this->translate('Are you sure you want to delete this album including all photos inside of it? <b>This action can not be reverted.</b>') ?> </p>
                </div>
                <div id="deleteProgress" style="display:none">
                    <center><p><?= $this->translate('Please wait while your album is being deleted.') ?></p></center>
                    <center><div id="coverPreview" class="spinner"></div></center>
                </div>
                <div id="deleteDone" style="display:none">
                <p><?= $this->translate('The album has been deleted') ?> </p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" id="deleteAlbumButton" class="btn btn-danger"><?= $this->translate('Delete album') ?></button>
                <button type="button" class="btn" data-dismiss="modal"><?= $this->translate('Cancel') ?></button>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function () {
        $('.tree').treed();
        Photo.Admin.init();
    });
</script>