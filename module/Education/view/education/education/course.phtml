<?php

declare(strict_types=1);

use Application\View\HelperTrait;
use Education\Model\Course as CourseModel;
use Education\Model\Enums\ExamTypes;
use Education\Model\Summary as SummaryModel;
use Laminas\View\Renderer\PhpRenderer;

/**
 * @var PhpRenderer|HelperTrait $this
 * @var CourseModel $course
 */

$this->headTitle(sprintf(
    '%s %s',
    $this->escapeHtml($course->getCode()),
    $this->escapeHtml($course->getName()),
));
$this->headTitle($this->translate('Education'));
?>
<section class="section">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h1><?= $this->escapeHtml($course->getCode()) ?> - <?= $this->escapeHtml($course->getName()) ?></h1>
            </div>
        </div>
        <hr>
        <div class="row">
            <div class="col-md-8">
                <h2><?= $this->translate('Exams and summaries') ?></h2>
                <ul>
                    <?php foreach ($course->getDocuments() as $document): ?>
                        <li>
                            <a href="<?= $this->url('education/course/download', [
                                'code' => $course->getCode(),
                                'id' => $document->getId()
                            ]) ?>">
                                <?php if ($document instanceof SummaryModel): ?>
                                    <?php if (null !== ($author = $document->getauthor())): ?>
                                        <?= sprintf(
                                            $this->translate('Summary by %s on %s (%s)'),
                                            $this->escapeHtml($document->getAuthor()),
                                            $document->getDate()->format('Y-m-d'),
                                            $document->getLanguage()->getName(
                                                $this->plugin('translate')->getTranslator()
                                            ),
                                        ) ?>
                                    <?php else: ?>
                                        <?= sprintf(
                                            $this->translate('Summary on %s (%s)'),
                                            $document->getDate()->format('Y-m-d'),
                                            $document->getLanguage()->getName(
                                                $this->plugin('translate')->getTranslator()
                                            ),
                                        ) ?>
                                    <?php endif; ?>
                                <?php else: ?>
                                    <?php
                                    switch ($document->getExamType()) {
                                        case ExamTypes::Final:
                                            $name = $this->translate('Final test from %s (%s)');
                                            break;
                                        case ExamTypes::Interim:
                                            $name = $this->translate('Interim test from %s (%s)');
                                            break;
                                        case ExamTypes::Answers:
                                            $name = $this->translate('Answers from %s (%s)');
                                            break;
                                        case ExamTypes::Other:
                                            $name = $this->translate('Other exam material from %s (%s)');
                                            break;
                                    }
                                    ?>
                                    <?= $this->escapeHtml(
                                        sprintf(
                                            $name,
                                            $document->getDate()->format('Y-m-d'),
                                            $document->getLanguage()->getName(
                                                $this->plugin('translate')->getTranslator()
                                            ),
                                        )
                                    ) ?>
                                <?php endif ?>
                            </a>
                        </li>
                    <?php endforeach; ?>
                </ul>
            </div>
        </div>
    </div>
</section>
