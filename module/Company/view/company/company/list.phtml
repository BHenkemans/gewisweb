<h1>Companies</h1>

<fieldset>
    <legend>Filter</legend>
    <label>All <input type="text" id="filter-all"></label>
    <label>Name <input type="text" id="filter-name"></label>
    <label>Location <input type="text" id="filter-location"></label>
    <label>Description <input type="text" id="filter-description"></label>
    <label>Job <input type="text" id="filter-job"></label>
</fieldset>

<div class="company-list">
<?php

$escaper = new Zend\Escaper\Escaper('utf-8');

if(isset($company)){
	$company_list = array();
	$company_list[] = $company;
}
if(!isset($company_list)){
	echo "Company not found";
	return;
}
foreach ($company_list as $company) {
    ?>
    <div class="company-list-item list-item" id="<?= $escaper->escapeHtmlAttr($company->getName()); ?>">
        <h2 class="company-name"><a href="company/<?= $company->getAsciiName(); ?>"><?= $company->getName(); ?></a></h2>
        <div class="company-slogan"><?= $company->getSlogan(); ?></div>
        <div class="company-logo"><img src="<?= $escaper->escapeHtmlAttr($company->getLogo()); ?>" alt="Logo of <?= $escaper->escapeHtmlAttr($company->getName()); ?>" /></div>
        <div class="company-address"><?= $company->getAddress(); ?></div>
        <div class="company-phone"><a href="tel:<?= rawurlencode($company->getPhone()); ?>"><?= $company->getPhone(); ?></a></div>
        <div class="company-website"><a href="<?= $company->getWebsite(); ?>">Visit website</a></div>
        <div class="company-email"><a href="mailto:<?= rawurlencode($company->getEmail()); ?>"><?= $company->getEmail(); ?></a></div>
        <div class="company-jobs">
            <ul class="company-jobs-list">
                <?php foreach($company->getJobs() as $job) { ?>
<li class="company-jobs-job"><a href="company/<?= $company->getAsciiName() ?>/jobs/<?= explode("_",$job->getAsciiName())[1] ?>"><?= $job->getName(); ?></a></li>
                <?php } ?>
            </ul>
        </div>
        <div class="company-description"><?= $company->getDescription(); ?></div>
        
    </div>
    <?php 
}

?>

    <script type="text/javascript">
        function filter_name(name) {
            $(".company-list-item").each(function() {
                if ($(this).find(".company-name a").text().toLowerCase().indexOf(name.toLowerCase())==-1) {
                    $(this).css({display: "none"});
                } else {
                    $(this).css({display: "block"});
                }
            });
        }

        function filter_location(location) {
            $(".company-list-item").each(function() {
                if ($(this).find(".company-address").text().toLowerCase().indexOf(location.toLowerCase())==-1) {
                    $(this).css({display: "none"});
                } else {
                    $(this).css({display: "block"});
                }
            });
        }

        function filter_description(description) {
            $(".company-list-item").each(function() {
                if ($(this).find(".company-description").text().toLowerCase().indexOf(description.toLowerCase())==-1) {
                    $(this).css({display: "none"});
                } else {
                    $(this).css({display: "block"});
                }
            });
        }

        function filter_job(job) {
            $(".company-list-item").each(function() {
                if ($(this).find(".company-jobs-list").text().toLowerCase().indexOf(job.toLowerCase())==-1) {
                    $(this).css({display: "none"});
                } else {
                    $(this).css({display: "block"});
                }
            });
        }

        function filter_all(term) {
            $(".company-list-item").each(function() {
                if ($(this).text().toLowerCase().indexOf(term.toLowerCase())==-1) {
                    $(this).css({display: "none"});
                } else {
                    $(this).css({display: "block"});
                }
            });
        }

        $("#filter-name").keyup(function() {
            filter_name($(this).val());
        });

        $("#filter-location").keyup(function() {
            filter_location($(this).val());
        });

        $("#filter-description").keyup(function() {
            filter_description($(this).val());
        });

        $("#filter-job").keyup(function() {
            filter_job($(this).val());
        });

        $("#filter-all").keyup(function() {
            filter_all($(this).val());
        });
    </script>

</div>
    
